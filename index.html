<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>HomeFX Trail Effect - Optimized</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: white;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #p5-holder { width: 100%; height: 100%; }

    /* Tela de loading */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #loading-rect {
      width: 100px;
      height: 100px;
      background: #c6c6c6;
    }
  </style>
</head>
<body>
<div id="p5-holder"></div>

<!-- Tela de Loading -->
<div id="loading-screen">
  <div id="loading-rect"></div>
</div>

<script>
new p5((p) => {
  const fileNames = [
    "https://ik.imagekit.io/q3d43lw6h/site/thumb_pp_00331.png",
    "https://ik.imagekit.io/q3d43lw6h/site/CAPA2811_pc1_1.png",
    "https://ik.imagekit.io/q3d43lw6h/site/thumb_fuzzy.png",
    "https://ik.imagekit.io/q3d43lw6h/site/Balma_maleta_mao-2.png",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_005.jpeg",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_002.jpeg",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_009.jpeg",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_003.jpeg"
  ];

  const tileSize = 60;
  const maxTiles = 150; // menos tiles = mais rÃ¡pido
  const mainRange = tileSize * 3 * 0.8;
  const fadeDuration = 500;

  let imgs = [], imgsGray = [];
  let tiles = [];
  let loadedCount = 0;

  const randomColor = () => [Math.floor(Math.random()*256), Math.floor(Math.random()*256), Math.floor(Math.random()*256)];
  const trailColors = [
    [128,128,128],
    [0,0,0],
    randomColor()
  ];

  // Loading blink
  const loadingRect = document.getElementById('loading-rect');
  let blink = true;
  setInterval(() => {
    blink = !blink;
    loadingRect.style.opacity = blink ? 1 : 0;
  }, 500);

  // Preload imagens
  fileNames.forEach((url, idx) => {
    p.loadImage(url, img => {
      imgs[idx] = img;
      let g = p.createImage(img.width, img.height);
      g.copy(img,0,0,img.width,img.height,0,0,img.width,img.height);
      g.filter(p.GRAY);
      imgsGray[idx] = g;
      loadedCount++;
      if (loadedCount === fileNames.length) {
        document.getElementById('loading-screen').remove();
        generateTiles();
      }
    });
  });

  function generateTiles() {
    tiles = [];
    for (let i=0; i<maxTiles; i++) {
      tiles.push({
        x: p.random(tileSize/2, p.width-tileSize/2),
        y: p.random(tileSize/2, p.height-tileSize/2),
        imgColor: imgs[i % imgs.length],
        imgGray: imgsGray[i % imgsGray.length],
        rot: 0,
        scale: 1,
        alpha: 0,
        targetAlpha: 0,
        targetScale: 1,
        targetRot: 0,
        trailColor: trailColors[Math.floor(p.random(trailColors.length))]
      });
    }
  }

  p.setup = () => {
    p.createCanvas(p.windowWidth, p.windowHeight).parent("p5-holder");
  };

  p.windowResized = () => {
    p.resizeCanvas(p.windowWidth, p.windowHeight);
    generateTiles();
  };

  p.draw = () => {
    if (loadedCount < fileNames.length) return;
    p.background(255);

    tiles.forEach(t => {
      const d = p.dist(p.mouseX, p.mouseY, t.x, t.y);
      const isMain = d < mainRange;
      t.targetScale = isMain ? 1.75 : 1;
      t.targetRot = isMain ? (Math.random()*0.2-0.1) : 0;
      t.targetAlpha = isMain ? 255 : 50;

      t.alpha = p.lerp(t.alpha, t.targetAlpha, 0.08);
      t.scale = p.lerp(t.scale, t.targetScale, 0.08);
      t.rot = p.lerp(t.rot, t.targetRot, 0.08);

      if (t.alpha > 0.1) {
        p.push();
        p.translate(t.x, t.y);
        p.rotate(t.rot);
        p.scale(t.scale);
        p.imageMode(p.CENTER);
        p.image(isMain ? t.imgColor : t.imgGray, 0, 0, tileSize, tileSize);
        p.pop();
      }
    });
  };
});
</script>
</body>
</html>
