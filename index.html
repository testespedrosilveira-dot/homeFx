<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>p5 Effect</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<style>
  body { margin:0; background:white; }
  #p5-holder { width:700px; height:500px; margin:0 auto; }
</style>
</head>
<body>
<div id="p5-holder"></div>

<script>
new p5((p) => {
  const fileNames = [
    "https://ik.imagekit.io/q3d43lw6h/site/thumb_pp_00331.png",
    "https://ik.imagekit.io/q3d43lw6h/site/CAPA2811_pc1_1.png",
    "https://ik.imagekit.io/q3d43lw6h/site/thumb_fuzzy.png",
    "https://ik.imagekit.io/q3d43lw6h/site/Balma_maleta_mao-2.png",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_005.jpeg",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_002.jpeg",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_009.jpeg",
    "https://ik.imagekit.io/q3d43lw6h/site/BudMag_003.jpeg"
  ];

  let imgs = [], imgsGray = [], tiles = [];
  const tileSize = 50;
  const totalTiles = 180;
  const canvasW = 700, canvasH = 500;
  let loadedCount = 0;

  function drawImageCover(img, w, h){
    let imgRatio = img.width / img.height;
    let boxRatio = w / h;
    let drawW = w, drawH = h;
    if(imgRatio > boxRatio){
      drawH = h;
      drawW = imgRatio * drawH;
    } else {
      drawW = w;
      drawH = drawW / imgRatio;
    }
    p.image(img, -drawW/2, -drawH/2, drawW, drawH);
  }

  // preload simplificado
  p.preload = () => {
    for(let i=0;i<fileNames.length;i++){
      imgs[i] = p.loadImage(fileNames[i]);
    }
  };

  p.setup = () => {
    p.createCanvas(canvasW, canvasH).parent("p5-holder");

    // criar grayscale
    imgs.forEach((img, i) => {
      let g = p.createImage(img.width, img.height);
      g.copy(img,0,0,img.width,img.height,0,0,img.width,img.height);
      g.loadPixels();
      for(let pIdx=0;pIdx<g.pixels.length;pIdx+=4){
        let gray = (g.pixels[pIdx]+g.pixels[pIdx+1]+g.pixels[pIdx+2])/3;
        g.pixels[pIdx] = g.pixels[pIdx+1] = g.pixels[pIdx+2] = gray;
      }
      g.updatePixels();
      imgsGray[i] = g;
    });

    // gerar tiles dentro do canvas
    for(let i=0;i<totalTiles;i++){
      const angle = p.random(p.TWO_PI);
      const r = Math.sqrt(p.random());
      const px = canvasW/2 + (canvasW*0.9/2)*r*Math.cos(angle);
      const py = canvasH/2 + (canvasH*0.7/2)*r*Math.sin(angle);
      tiles.push({
        x:px, y:py,
        imgColor: imgs[i % imgs.length],
        imgGray: imgsGray[i % imgsGray.length],
        rot:0, scale:1
      });
    }
  };

  p.draw = () => {
    p.background(255);
    for(let t of tiles){
      const d = p.dist(p.mouseX, p.mouseY, t.x, t.y);
      let isMain = false;

      if(d < tileSize*0.8){ t.rot=p.lerp(t.rot,0.1,0.25); t.scale=p.lerp(t.scale,1.45,0.25); isMain=true;}
      else if(d<tileSize*1.5){ t.rot=p.lerp(t.rot,0,0.15); t.scale=p.lerp(t.scale,0.85,0.12);}
      else{ t.rot=p.lerp(t.rot,0,0.1); t.scale=p.lerp(t.scale,1.0,0.1);}

      p.push();
      p.translate(t.x,t.y);
      p.rotate(t.rot);
      p.scale(t.scale);
      p.imageMode(p.CENTER);
      if(isMain) drawImageCover(t.imgColor,tileSize,tileSize);
      else drawImageCover(t.imgGray,tileSize,tileSize);
      p.pop();
    }
  };
});
</script>
</body>
</html>
